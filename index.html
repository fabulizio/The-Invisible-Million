<!DOCTYPE html>
<html>
<head>
  <title>Donate to Color a Pixel</title>
  <style>
    #grid {
      display: grid;
      grid-template-columns: repeat(100, 10px); /* showing only 100x100 for performance */
      grid-template-rows: repeat(100, 10px);
    }
    .square {
      width: 10px;
      height: 10px;
      background-color: #ccc;
      border: 1px solid #eee;
    }
  </style>
</head>
<body>
  <h1>Pixel Grid (1000x1000 virtual, 100x100 visible)</h1>
  <button onclick="donate()">Donate & Color</button>
  <div id="grid"></div>

  <script>
    const grid = document.getElementById("grid");
    const VISIBLE_SIZE = 100; // what we render
    const TOTAL_SIZE = 1000; // logic grid
    const backendUrl = 'https://155ca338-0e90-4f5a-88ec-b6163921baae-00-181dgn4pq10j7.janeway.replit.dev';

    // Load painted squares
    fetch(`${backendUrl}/painted`)
      .then(res => res.json())
      .then(data => {
        for (let y = 0; y < VISIBLE_SIZE; y++) {
          for (let x = 0; x < VISIBLE_SIZE; x++) {
            const div = document.createElement("div");
            div.className = "square";
            const key = `${x},${y}`;
            if (data[key]) {
              div.style.backgroundColor = data[key];
            }
            div.onclick = () => colorSquare(x, y);
            grid.appendChild(div);
          }
        }
      });

    function donate() {
      const color = prompt("Enter a color (e.g. red or #ff0000):");
      const x = parseInt(prompt("Enter X coordinate (0-999):"));
      const y = parseInt(prompt("Enter Y coordinate (0-999):"));

      if (isNaN(x) || isNaN(y) || x < 0 || x >= TOTAL_SIZE || y < 0 || y >= TOTAL_SIZE) {
        alert("Invalid coordinates!");
        return;
      }

      fetch(`${backendUrl}/paint`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ x, y, color })
      }).then(() => {
        alert(`Square at (${x},${y}) colored!`);
        location.reload();
      });
    }

    function colorSquare(x, y) {
      alert(`Square at (${x},${y})`);
    }
  </script>
</body>
</html>
